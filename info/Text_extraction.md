Извлечение текста
=====================

Для извлечения текста из информационных блоков с метками «текст», «заголовок» и «список» используется функция **extract_text** экземпляра класса **TextPageElement**. 

Teseract OCR
-----------------------------------

Для работы с отсканированными документами или в том случае, когда pdftotext не извлек текст из документа типа searchable, используется инструмент с открытым исходным кодом [Tesseract OCR](https://github.com/tesseract-ocr/tesseract). Начиная с четвертой версии, Tesseract OCR поддерживает модели по распознаванию текста с изображения на основе нейронных сетей с LSTM архитектурой. 

Общая последовательность работы системы Tesseract OCR следующая:
1)	[Использование метода Adaptive Thresholding](https://ieeexplore.ieee.org/document/4310076), который преобразует изображение в бинарную версию;
2)	Понимание размещения объектов на изображении для выделения только тех областей, которые содержат текст;
3)	Использование LSTM-сети, на вход которой поступает изображение строки текста;
4)	Проверка распознанных слов: если все распознанные слова содержатся в словаре, то на этом последовательность работы системы с текущей строкой прекращается, если нет, то происходит дальнейшая обработка;
5)	Применяется распознавание слов первого этапа на основе правил;
6)	Применяется распознавание слов второго этапа на основе правил.

В качестве нейронной сети применяется не классическая LSTM, а архитектура [Variable Graph Specification Language](https://tesseract-ocr.github.io/tessdoc/VGSLSpecs). Эта архитектура позволяет LSTM сверткам обрабатывать изображения строк текста разной длины, поступающие на вход Tesseract OCR.

Устанавливается Tesseract OCR через пакетный менеджер apt в Ubuntu:

*sudo apt update && sudo apt install tesseract-ocr*

Также для удобной интеграции с python устанавливаем пакет pytesseract:

*pip3 install pytesseract –user*

Для дальнейшего использования необходимо добавить поддержку русского и латинского языка, т. к. в тексте статей могут встречаться подписи на латыни, а основная часть текста может содержать как русский, так и английский язык. Для этого необходимо выполнить следующий набор команд:

*sudo apt install tesseract-rus && sudo apt install tesseract-lat*

Перед началом использования необходимо задать несколько параметров:

•	oem (целое число) – параметр, отвечающий за тип используемой модели, необходимое значение – 1 (использование LSTM архитектуры);

•	psm (целое число) – параметр, отвечающий за тип входящего изображения и режим распознавания (одно слово, одна строка, абзац), необходимое значение – 6 (абзац);

•	l (строка) – параметр, отвечающий за используемый язык. Если текст распознается на нескольких языках одновременно, то передаются сокращения языков через знак «+», необходимое значение – rus+eng+lat. 

pdftotext
-----------------------------------

Для работы с сгенерированными документами используется библиотека [pdftotext](https://www.xpdfreader.com/pdftotext-man.html). Pdftotext преобразует файлы PDF в обычный текст. 

Для использования библиотеки необходимо в командной строке ввести следующую команду: 

**pdftotext [options] [PDF-file [text-file]]**, 

где **PDF-file** – это путь до файла в формате PDF, **text-file** – итоговый текстовый файл, а **options** – параметры конвертации.  Если текстовым файлом является «-», текст отправляется на стандартный вывод. 

Для задач данной системы необходимо задавать следующие параметры:

•	f (целое число) – задает первую страницу для конвертации;

•	l (целое число) – указывает последнюю страницу для конвертации;

•	r (целое число) – определяет разрешение в DPI. По умолчанию установлено значение 72 DPI;

•	х (целое число) – определяет x-координату левого верхнего угла области обрезки;

•	y (целое число) – определяет y-координату левого верхнего угла области обрезки;

•	W (целое число) – определяет ширину области обрезки в пикселях (по умолчанию 0);

•	Н (целое число) – определяет высоту области обрезки в пикселях (по умолчанию 0);

•	enc (строка) – устанавливает кодировку, используемую для вывода текста. 

Для работы с pdftotext используется библиотека Python Subprocess. Модуль подпроцесса позволяет создавать новые процессы, подключаться к их каналам ввода/вывода/ошибок и получать результат их выполнения. С его помощью запускается pdftotext с необходимыми параметрами, а результат выводится в переменную res, где затем декодируется и обрабатывается регулярными выражениями с целью избавиться от нечитаемых символов юникода.